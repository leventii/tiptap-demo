import React, { useState } from 'react'
import { useEditor, EditorContent } from '@tiptap/react'
import MenuBar from './menubar'
import StarterKit from '@tiptap/starter-kit'
import Color from '@tiptap/extension-color'
import FontFamily from '@tiptap/extension-font-family'
import Highlight from '@tiptap/extension-highlight'
import Image from '@tiptap/extension-image'
import Subscript from '@tiptap/extension-subscript'
import Superscript from '@tiptap/extension-superscript'
import TextAlign from '@tiptap/extension-text-align'
import TextStyle from '@tiptap/extension-text-style'
import Typography from '@tiptap/extension-typography'
import Underline from '@tiptap/extension-underline'

// extend textstyle extension to add fontsize
const FontSize = TextStyle.extend({ 
  name: 'fontSize',

  defaultOptions: {
    types: ['textStyle'],
  },

  addGlobalAttributes() {
    return [
      {
        types: this.options.types,
        attributes: {
          fontSize: {
            default: null,
            renderHTML: attributes => {
              if (!attributes.fontSize) {
                return {}
              }

              return {
                style: `font-size: ${attributes.fontSize}`,
              }
            },
            parseHTML: element => ({
              fontSize: element.style.fontSize.replace(/['"]+/g, ''),
            }),
          },
        },
      },
    ]
  },

  addCommands() {
    return {
      setFontSize: fontSize => ({ chain }) => {
        return chain()
          .setMark('textStyle', { fontSize })
          .run()
      },
      unsetFontSize: () => ({ chain }) => {
        return chain()
          .setMark('textStyle', { fontSize: null })
          .removeEmptyTextStyle()
          .run()
      },
    }
  },
})

const Editor = () => {
  const editor = useEditor({
    extensions: [
      Color,
      FontFamily,
      FontSize,
      Highlight,
      Image,
      StarterKit.configure({
        // disable this for collab extension history: false,
      }),
      Subscript,
      Superscript,
      TextAlign.configure({
        types: ['heading', 'paragraph'],
      }),
      TextStyle,
      Typography,
      Underline
    ],
    content: `
      <h2>
        Hi there,
      </h2>
      <p>
        this is a <em>basic</em> example of <strong>tiptap</strong>. Sure, there are all kind of basic text styles you‚Äôd probably expect from a text editor. But wait until you see the lists:
      </p>
      <ul>
        <li>
          That‚Äôs a bullet list with one ‚Ä¶
        </li>
        <li>
          ‚Ä¶ or two list items.
        </li>
      </ul>
      <p>
        Isn‚Äôt that great? And all of that is editable. But wait, there‚Äôs more. Let‚Äôs try a code block:
      </p>
      <pre><code class="language-css">body {
  display: none;
}</code></pre>
      <p>
        I know, I know, this is impressive. It‚Äôs only the tip of the iceberg though. Give it a try and click a little bit around. Don‚Äôt forget to check the other examples too.
      </p>
      <blockquote>
        Wow, that‚Äôs amazing. Good work, boy! üëè
        <br />
        ‚Äî Mom
      </blockquote>
    `
  })

  return (
    <div>
      <MenuBar editor={editor} />
      <EditorContent editor={editor} />
    </div>
  )
}

export default Editor